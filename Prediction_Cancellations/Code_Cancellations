{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "oUrSrpKqdC79",
    "outputId": "541ca4c0-8208-4a46-8491-8859d5039adc"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Collecting https://github.com/pandas-profiling/pandas-profiling/archive/master.zip\n",
      "\u001b[?25l  Downloading https://github.com/pandas-profiling/pandas-profiling/archive/master.zip\n",
      "\u001b[K     / 38.3MB 6.5MB/s\n",
      "\u001b[?25hRequirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (1.0.1)\n",
      "Requirement already satisfied: scipy>=1.4.1 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (1.4.1)\n",
      "Requirement already satisfied: pandas!=1.0.0,!=1.0.1,!=1.0.2,!=1.1.0,>=0.25.3 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (1.1.5)\n",
      "Requirement already satisfied: matplotlib>=3.2.0 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (3.2.2)\n",
      "Collecting confuse>=1.0.0\n",
      "  Downloading https://files.pythonhosted.org/packages/6d/55/b4726d81e5d6509fa3441f770f8a9524612627dc1b2a7d6209d1d20083fe/confuse-1.4.0-py2.py3-none-any.whl\n",
      "Requirement already satisfied: jinja2>=2.11.1 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (2.11.3)\n",
      "Collecting visions[type_image_path]==0.6.0\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/98/30/b1e70bc55962239c4c3c9660e892be2d8247a882135a3035c10ff7f02cde/visions-0.6.0-py3-none-any.whl (75kB)\n",
      "\u001b[K     |████████████████████████████████| 81kB 3.8MB/s \n",
      "\u001b[?25hRequirement already satisfied: numpy>=1.16.0 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (1.19.5)\n",
      "Requirement already satisfied: attrs>=19.3.0 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (20.3.0)\n",
      "Collecting htmlmin>=0.1.12\n",
      "  Downloading https://files.pythonhosted.org/packages/b3/e7/fcd59e12169de19f0131ff2812077f964c6b960e7c09804d30a7bf2ab461/htmlmin-0.1.12.tar.gz\n",
      "Requirement already satisfied: missingno>=0.4.2 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (0.4.2)\n",
      "Collecting phik>=0.10.0\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/b7/ce/193e8ddf62d4be643b9b4b20e8e9c63b2f6a20f92778c0410c629f89bdaa/phik-0.11.2.tar.gz (1.1MB)\n",
      "\u001b[K     |████████████████████████████████| 1.1MB 9.0MB/s \n",
      "\u001b[?25hCollecting tangled-up-in-unicode>=0.0.6\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/ec/d1/58bfbe263494741a47140049b989ad42a8941854e8d34f1af90640c6c9f9/tangled_up_in_unicode-0.0.7-py3-none-any.whl (3.1MB)\n",
      "\u001b[K     |████████████████████████████████| 3.2MB 18.6MB/s \n",
      "\u001b[?25hCollecting requests>=2.24.0\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/29/c1/24814557f1d22c56d50280771a17307e6bf87b70727d975fd6b2ce6b014a/requests-2.25.1-py2.py3-none-any.whl (61kB)\n",
      "\u001b[K     |████████████████████████████████| 61kB 6.0MB/s \n",
      "\u001b[?25hCollecting tqdm>=4.48.2\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/f8/3e/2730d0effc282960dbff3cf91599ad0d8f3faedc8e75720fdf224b31ab24/tqdm-4.59.0-py2.py3-none-any.whl (74kB)\n",
      "\u001b[K     |████████████████████████████████| 81kB 260kB/s \n",
      "\u001b[?25hRequirement already satisfied: seaborn>=0.10.1 in /usr/local/lib/python3.7/dist-packages (from pandas-profiling==2.12.0) (0.11.1)\n",
      "Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas!=1.0.0,!=1.0.1,!=1.0.2,!=1.1.0,>=0.25.3->pandas-profiling==2.12.0) (2.8.1)\n",
      "Requirement already satisfied: pytz>=2017.2 in /usr/local/lib/python3.7/dist-packages (from pandas!=1.0.0,!=1.0.1,!=1.0.2,!=1.1.0,>=0.25.3->pandas-profiling==2.12.0) (2018.9)\n",
      "Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib>=3.2.0->pandas-profiling==2.12.0) (0.10.0)\n",
      "Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib>=3.2.0->pandas-profiling==2.12.0) (1.3.1)\n",
      "Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib>=3.2.0->pandas-profiling==2.12.0) (2.4.7)\n",
      "Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from confuse>=1.0.0->pandas-profiling==2.12.0) (3.13)\n",
      "Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from jinja2>=2.11.1->pandas-profiling==2.12.0) (1.1.1)\n",
      "Requirement already satisfied: networkx>=2.4 in /usr/local/lib/python3.7/dist-packages (from visions[type_image_path]==0.6.0->pandas-profiling==2.12.0) (2.5)\n",
      "Requirement already satisfied: Pillow; extra == \"type_image_path\" in /usr/local/lib/python3.7/dist-packages (from visions[type_image_path]==0.6.0->pandas-profiling==2.12.0) (7.0.0)\n",
      "Collecting imagehash; extra == \"type_image_path\"\n",
      "\u001b[?25l  Downloading https://files.pythonhosted.org/packages/8e/18/9dbb772b5ef73a3069c66bb5bf29b9fb4dd57af0d5790c781c3f559bcca6/ImageHash-4.2.0-py2.py3-none-any.whl (295kB)\n",
      "\u001b[K     |████████████████████████████████| 296kB 46.1MB/s \n",
      "\u001b[?25hRequirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests>=2.24.0->pandas-profiling==2.12.0) (3.0.4)\n",
      "Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests>=2.24.0->pandas-profiling==2.12.0) (2.10)\n",
      "Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests>=2.24.0->pandas-profiling==2.12.0) (2020.12.5)\n",
      "Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests>=2.24.0->pandas-profiling==2.12.0) (1.24.3)\n",
      "Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas!=1.0.0,!=1.0.1,!=1.0.2,!=1.1.0,>=0.25.3->pandas-profiling==2.12.0) (1.15.0)\n",
      "Requirement already satisfied: decorator>=4.3.0 in /usr/local/lib/python3.7/dist-packages (from networkx>=2.4->visions[type_image_path]==0.6.0->pandas-profiling==2.12.0) (4.4.2)\n",
      "Requirement already satisfied: PyWavelets in /usr/local/lib/python3.7/dist-packages (from imagehash; extra == \"type_image_path\"->visions[type_image_path]==0.6.0->pandas-profiling==2.12.0) (1.1.1)\n",
      "Building wheels for collected packages: pandas-profiling, htmlmin, phik\n",
      "  Building wheel for pandas-profiling (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
      "  Created wheel for pandas-profiling: filename=pandas_profiling-2.12.0-py2.py3-none-any.whl size=243829 sha256=fe8d874a9680595e71a3eedf306e67005c95a457e6e82346f6d71e9ca92bc0b8\n",
      "  Stored in directory: /tmp/pip-ephem-wheel-cache-wjkvx0mg/wheels/56/c2/dd/8d945b0443c35df7d5f62fa9e9ae105a2d8b286302b92e0109\n",
      "  Building wheel for htmlmin (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
      "  Created wheel for htmlmin: filename=htmlmin-0.1.12-cp37-none-any.whl size=27085 sha256=1f0a1f330aaa47b2b56063a89e11450307fb194b239f8b0a0e7610a6ea6807a8\n",
      "  Stored in directory: /root/.cache/pip/wheels/43/07/ac/7c5a9d708d65247ac1f94066cf1db075540b85716c30255459\n",
      "  Building wheel for phik (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
      "  Created wheel for phik: filename=phik-0.11.2-cp37-none-any.whl size=1107413 sha256=b70c6a1c0cf0c28f601f095fe430d0877adcb6165b999b3bd22ab63a80a2f9b8\n",
      "  Stored in directory: /root/.cache/pip/wheels/c0/a3/b0/f27b1cfe32ea131a3715169132ff6d85653789e80e966c3bf6\n",
      "Successfully built pandas-profiling htmlmin phik\n",
      "\u001b[31mERROR: google-colab 1.0.0 has requirement requests~=2.23.0, but you'll have requests 2.25.1 which is incompatible.\u001b[0m\n",
      "\u001b[31mERROR: datascience 0.10.6 has requirement folium==0.2.1, but you'll have folium 0.8.3 which is incompatible.\u001b[0m\n",
      "\u001b[31mERROR: phik 0.11.2 has requirement scipy>=1.5.2, but you'll have scipy 1.4.1 which is incompatible.\u001b[0m\n",
      "Installing collected packages: confuse, tangled-up-in-unicode, imagehash, visions, htmlmin, phik, requests, tqdm, pandas-profiling\n",
      "  Found existing installation: requests 2.23.0\n",
      "    Uninstalling requests-2.23.0:\n",
      "      Successfully uninstalled requests-2.23.0\n",
      "  Found existing installation: tqdm 4.41.1\n",
      "    Uninstalling tqdm-4.41.1:\n",
      "      Successfully uninstalled tqdm-4.41.1\n",
      "  Found existing installation: pandas-profiling 1.4.1\n",
      "    Uninstalling pandas-profiling-1.4.1:\n",
      "      Successfully uninstalled pandas-profiling-1.4.1\n",
      "Successfully installed confuse-1.4.0 htmlmin-0.1.12 imagehash-4.2.0 pandas-profiling-2.12.0 phik-0.11.2 requests-2.25.1 tangled-up-in-unicode-0.0.7 tqdm-4.59.0 visions-0.6.0\n"
     ]
    }
   ],
   "source": [
    " ! pip install https://github.com/pandas-profiling/pandas-profiling/archive/master.zip "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 259,
   "metadata": {
    "id": "6BMCKa_Ldi6f"
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from pandas_profiling import ProfileReport\n",
    "import seaborn as sns\n",
    "import matplotlib.pyplot as plt\n",
    "import matplotlib.cm as cm\n",
    "from sklearn.metrics import plot_confusion_matrix\n",
    "from sklearn.metrics import classification_report, confusion_matrix\n",
    "from sklearn.model_selection import KFold\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.metrics import f1_score\n",
    "from sklearn.model_selection import StratifiedKFold\n",
    "from sklearn.preprocessing import OrdinalEncoder\n",
    "from sklearn.tree import DecisionTreeClassifier\n",
    "from sklearn.ensemble import RandomForestClassifier\n",
    "from sklearn.model_selection import GridSearchCV\n",
    "from sklearn.preprocessing import OneHotEncoder\n",
    "from sklearn import tree\n",
    "from math import ceil\n",
    "import time\n",
    "\n",
    "\n",
    "sns.set()\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "dz5TYlbqY86q"
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "At_PeZfgZCem"
   },
   "source": [
    "# Read Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 260,
   "metadata": {
    "id": "0l0cP8vQpcB-"
   },
   "outputs": [],
   "source": [
    "url = 'https://github.com/joaopfonseca/business-cases/blob/7d95f4d49e04d2eabeae742310eecd30b419251e/BC2_predicting_cancellations/H2.csv?raw=true'\n",
    "df = pd.read_csv(url)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 261,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 224
    },
    "id": "vRcWhTJgeWg9",
    "outputId": "e4321c78-be2a-459f-e035-998d56a2ab3f"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>IsCanceled</th>\n",
       "      <th>LeadTime</th>\n",
       "      <th>ArrivalDateYear</th>\n",
       "      <th>ArrivalDateMonth</th>\n",
       "      <th>ArrivalDateWeekNumber</th>\n",
       "      <th>ArrivalDateDayOfMonth</th>\n",
       "      <th>StaysInWeekendNights</th>\n",
       "      <th>StaysInWeekNights</th>\n",
       "      <th>Adults</th>\n",
       "      <th>Children</th>\n",
       "      <th>Babies</th>\n",
       "      <th>Meal</th>\n",
       "      <th>Country</th>\n",
       "      <th>MarketSegment</th>\n",
       "      <th>DistributionChannel</th>\n",
       "      <th>IsRepeatedGuest</th>\n",
       "      <th>PreviousCancellations</th>\n",
       "      <th>PreviousBookingsNotCanceled</th>\n",
       "      <th>ReservedRoomType</th>\n",
       "      <th>AssignedRoomType</th>\n",
       "      <th>BookingChanges</th>\n",
       "      <th>DepositType</th>\n",
       "      <th>Agent</th>\n",
       "      <th>Company</th>\n",
       "      <th>DaysInWaitingList</th>\n",
       "      <th>CustomerType</th>\n",
       "      <th>ADR</th>\n",
       "      <th>RequiredCarParkingSpaces</th>\n",
       "      <th>TotalOfSpecialRequests</th>\n",
       "      <th>ReservationStatus</th>\n",
       "      <th>ReservationStatusDate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>HB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Offline TA/TO</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>6</td>\n",
       "      <td>NULL</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Check-Out</td>\n",
       "      <td>2015-07-03</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>88</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>NULL</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-07-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>65</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>NULL</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>68.0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-04-30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>92</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>NULL</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-06-23</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>100</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>NULL</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-04-02</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   IsCanceled  LeadTime  ...  ReservationStatus ReservationStatusDate\n",
       "0           0         6  ...          Check-Out            2015-07-03\n",
       "1           1        88  ...           Canceled            2015-07-01\n",
       "2           1        65  ...           Canceled            2015-04-30\n",
       "3           1        92  ...           Canceled            2015-06-23\n",
       "4           1       100  ...           Canceled            2015-04-02\n",
       "\n",
       "[5 rows x 31 columns]"
      ]
     },
     "execution_count": 261,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 262,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "iAaL4NxbaCp2",
    "outputId": "de4adbc5-3b40-43f0-b6cc-e70eb0e1b021"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 79330 entries, 0 to 79329\n",
      "Data columns (total 31 columns):\n",
      " #   Column                       Non-Null Count  Dtype  \n",
      "---  ------                       --------------  -----  \n",
      " 0   IsCanceled                   79330 non-null  int64  \n",
      " 1   LeadTime                     79330 non-null  int64  \n",
      " 2   ArrivalDateYear              79330 non-null  int64  \n",
      " 3   ArrivalDateMonth             79330 non-null  object \n",
      " 4   ArrivalDateWeekNumber        79330 non-null  int64  \n",
      " 5   ArrivalDateDayOfMonth        79330 non-null  int64  \n",
      " 6   StaysInWeekendNights         79330 non-null  int64  \n",
      " 7   StaysInWeekNights            79330 non-null  int64  \n",
      " 8   Adults                       79330 non-null  int64  \n",
      " 9   Children                     79326 non-null  float64\n",
      " 10  Babies                       79330 non-null  int64  \n",
      " 11  Meal                         79330 non-null  object \n",
      " 12  Country                      79306 non-null  object \n",
      " 13  MarketSegment                79330 non-null  object \n",
      " 14  DistributionChannel          79330 non-null  object \n",
      " 15  IsRepeatedGuest              79330 non-null  int64  \n",
      " 16  PreviousCancellations        79330 non-null  int64  \n",
      " 17  PreviousBookingsNotCanceled  79330 non-null  int64  \n",
      " 18  ReservedRoomType             79330 non-null  object \n",
      " 19  AssignedRoomType             79330 non-null  object \n",
      " 20  BookingChanges               79330 non-null  int64  \n",
      " 21  DepositType                  79330 non-null  object \n",
      " 22  Agent                        79330 non-null  object \n",
      " 23  Company                      79330 non-null  object \n",
      " 24  DaysInWaitingList            79330 non-null  int64  \n",
      " 25  CustomerType                 79330 non-null  object \n",
      " 26  ADR                          79330 non-null  float64\n",
      " 27  RequiredCarParkingSpaces     79330 non-null  int64  \n",
      " 28  TotalOfSpecialRequests       79330 non-null  int64  \n",
      " 29  ReservationStatus            79330 non-null  object \n",
      " 30  ReservationStatusDate        79330 non-null  object \n",
      "dtypes: float64(2), int64(16), object(13)\n",
      "memory usage: 18.8+ MB\n"
     ]
    }
   ],
   "source": [
    "df.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 263,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 410
    },
    "id": "OUfBPqtmaCwU",
    "outputId": "0c2c2773-6a81-4949-b307-1e193542d4ae"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>IsCanceled</th>\n",
       "      <th>LeadTime</th>\n",
       "      <th>ArrivalDateYear</th>\n",
       "      <th>ArrivalDateMonth</th>\n",
       "      <th>ArrivalDateWeekNumber</th>\n",
       "      <th>ArrivalDateDayOfMonth</th>\n",
       "      <th>StaysInWeekendNights</th>\n",
       "      <th>StaysInWeekNights</th>\n",
       "      <th>Adults</th>\n",
       "      <th>Children</th>\n",
       "      <th>Babies</th>\n",
       "      <th>Meal</th>\n",
       "      <th>Country</th>\n",
       "      <th>MarketSegment</th>\n",
       "      <th>DistributionChannel</th>\n",
       "      <th>IsRepeatedGuest</th>\n",
       "      <th>PreviousCancellations</th>\n",
       "      <th>PreviousBookingsNotCanceled</th>\n",
       "      <th>ReservedRoomType</th>\n",
       "      <th>AssignedRoomType</th>\n",
       "      <th>BookingChanges</th>\n",
       "      <th>DepositType</th>\n",
       "      <th>Agent</th>\n",
       "      <th>Company</th>\n",
       "      <th>DaysInWaitingList</th>\n",
       "      <th>CustomerType</th>\n",
       "      <th>ADR</th>\n",
       "      <th>RequiredCarParkingSpaces</th>\n",
       "      <th>TotalOfSpecialRequests</th>\n",
       "      <th>ReservationStatus</th>\n",
       "      <th>ReservationStatusDate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79326.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79306</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330.000000</td>\n",
       "      <td>79330</td>\n",
       "      <td>79330</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>unique</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>12</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4</td>\n",
       "      <td>166</td>\n",
       "      <td>8</td>\n",
       "      <td>5</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>8</td>\n",
       "      <td>9</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>224</td>\n",
       "      <td>208</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3</td>\n",
       "      <td>864</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>top</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>August</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>NaN</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>NULL</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Transient</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>Check-Out</td>\n",
       "      <td>2015-10-21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>freq</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>8983</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>62305</td>\n",
       "      <td>30960</td>\n",
       "      <td>38748</td>\n",
       "      <td>68945</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>62595</td>\n",
       "      <td>57007</td>\n",
       "      <td>NaN</td>\n",
       "      <td>66442</td>\n",
       "      <td>31955</td>\n",
       "      <td>75641</td>\n",
       "      <td>NaN</td>\n",
       "      <td>59404</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>46228</td>\n",
       "      <td>1416</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>0.417270</td>\n",
       "      <td>109.735724</td>\n",
       "      <td>2016.174285</td>\n",
       "      <td>NaN</td>\n",
       "      <td>27.177449</td>\n",
       "      <td>15.786625</td>\n",
       "      <td>0.795185</td>\n",
       "      <td>2.182957</td>\n",
       "      <td>1.850977</td>\n",
       "      <td>0.091370</td>\n",
       "      <td>0.004941</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.025615</td>\n",
       "      <td>0.079743</td>\n",
       "      <td>0.132371</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.187369</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3.226774</td>\n",
       "      <td>NaN</td>\n",
       "      <td>105.304465</td>\n",
       "      <td>0.024367</td>\n",
       "      <td>0.546918</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>0.493111</td>\n",
       "      <td>110.948526</td>\n",
       "      <td>0.699181</td>\n",
       "      <td>NaN</td>\n",
       "      <td>13.398523</td>\n",
       "      <td>8.728451</td>\n",
       "      <td>0.885026</td>\n",
       "      <td>1.456416</td>\n",
       "      <td>0.509292</td>\n",
       "      <td>0.372177</td>\n",
       "      <td>0.084323</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.157983</td>\n",
       "      <td>0.415472</td>\n",
       "      <td>1.693411</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.608620</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>20.870890</td>\n",
       "      <td>NaN</td>\n",
       "      <td>43.602954</td>\n",
       "      <td>0.154919</td>\n",
       "      <td>0.780776</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>2015.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>23.000000</td>\n",
       "      <td>2016.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>79.200000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>74.000000</td>\n",
       "      <td>2016.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>27.000000</td>\n",
       "      <td>16.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>99.900000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>1.000000</td>\n",
       "      <td>163.000000</td>\n",
       "      <td>2017.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>38.000000</td>\n",
       "      <td>23.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>126.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>1.000000</td>\n",
       "      <td>629.000000</td>\n",
       "      <td>2017.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>53.000000</td>\n",
       "      <td>31.000000</td>\n",
       "      <td>16.000000</td>\n",
       "      <td>41.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>21.000000</td>\n",
       "      <td>72.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>21.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>391.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5400.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          IsCanceled      LeadTime  ...  ReservationStatus ReservationStatusDate\n",
       "count   79330.000000  79330.000000  ...              79330                 79330\n",
       "unique           NaN           NaN  ...                  3                   864\n",
       "top              NaN           NaN  ...          Check-Out            2015-10-21\n",
       "freq             NaN           NaN  ...              46228                  1416\n",
       "mean        0.417270    109.735724  ...                NaN                   NaN\n",
       "std         0.493111    110.948526  ...                NaN                   NaN\n",
       "min         0.000000      0.000000  ...                NaN                   NaN\n",
       "25%         0.000000     23.000000  ...                NaN                   NaN\n",
       "50%         0.000000     74.000000  ...                NaN                   NaN\n",
       "75%         1.000000    163.000000  ...                NaN                   NaN\n",
       "max         1.000000    629.000000  ...                NaN                   NaN\n",
       "\n",
       "[11 rows x 31 columns]"
      ]
     },
     "execution_count": 263,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.describe(include='all')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "08s29PoUaSc2"
   },
   "source": [
    "# Data Understanding"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 264,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "qRPL1tPOaC0C",
    "outputId": "892f7c6a-9ed3-4156-fad6-c1cff69e015c"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "25902"
      ]
     },
     "execution_count": 264,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.duplicated().sum()\n",
    "#these observations were not considered as duplicates, but as similar bookings of different people"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 265,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "RqSgrzMNbdib",
    "outputId": "7cd5d1d3-03db-4bff-bd06-3bebf5834451"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "IsCanceled                      0\n",
       "LeadTime                        0\n",
       "ArrivalDateYear                 0\n",
       "ArrivalDateMonth                0\n",
       "ArrivalDateWeekNumber           0\n",
       "ArrivalDateDayOfMonth           0\n",
       "StaysInWeekendNights            0\n",
       "StaysInWeekNights               0\n",
       "Adults                          0\n",
       "Children                        4\n",
       "Babies                          0\n",
       "Meal                            0\n",
       "Country                        24\n",
       "MarketSegment                   0\n",
       "DistributionChannel             0\n",
       "IsRepeatedGuest                 0\n",
       "PreviousCancellations           0\n",
       "PreviousBookingsNotCanceled     0\n",
       "ReservedRoomType                0\n",
       "AssignedRoomType                0\n",
       "BookingChanges                  0\n",
       "DepositType                     0\n",
       "Agent                           0\n",
       "Company                         0\n",
       "DaysInWaitingList               0\n",
       "CustomerType                    0\n",
       "ADR                             0\n",
       "RequiredCarParkingSpaces        0\n",
       "TotalOfSpecialRequests          0\n",
       "ReservationStatus               0\n",
       "ReservationStatusDate           0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 265,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.isna().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "U7z-LPboc_kt"
   },
   "source": [
    "## Pandas Profilling"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 266,
   "metadata": {
    "id": "9TXXnoWLd0Jp"
   },
   "outputs": [],
   "source": [
    "#profile=ProfileReport(df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 267,
   "metadata": {
    "id": "lUqHV2erd0Mn"
   },
   "outputs": [],
   "source": [
    "#profile.to_notebook_iframe()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "8nhcCsTsaxCH"
   },
   "source": [
    "# Data Preparation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 268,
   "metadata": {
    "id": "eYPmQo4rbdqX"
   },
   "outputs": [],
   "source": [
    "#replace NA with 0\n",
    "df.replace(np.nan,0, inplace=True)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "RC74u12ga39e"
   },
   "source": [
    "## Data cleaning"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 269,
   "metadata": {
    "id": "17jIwFOOd0R5"
   },
   "outputs": [],
   "source": [
    "#take out spaces of 'null'\n",
    "df['Company']=df['Company'].apply(lambda x : x.lstrip()) \n",
    "df['Agent']=df['Agent'].apply(lambda x : x.lstrip())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 270,
   "metadata": {
    "id": "ikLbq9GTd0Xk"
   },
   "outputs": [],
   "source": [
    "df.replace('NULL',0, inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 271,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 224
    },
    "id": "4_GWcwhtd0c1",
    "outputId": "06fb8bea-0a2e-46cb-fbde-7668e4e9adfe"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>IsCanceled</th>\n",
       "      <th>LeadTime</th>\n",
       "      <th>ArrivalDateYear</th>\n",
       "      <th>ArrivalDateMonth</th>\n",
       "      <th>ArrivalDateWeekNumber</th>\n",
       "      <th>ArrivalDateDayOfMonth</th>\n",
       "      <th>StaysInWeekendNights</th>\n",
       "      <th>StaysInWeekNights</th>\n",
       "      <th>Adults</th>\n",
       "      <th>Children</th>\n",
       "      <th>Babies</th>\n",
       "      <th>Meal</th>\n",
       "      <th>Country</th>\n",
       "      <th>MarketSegment</th>\n",
       "      <th>DistributionChannel</th>\n",
       "      <th>IsRepeatedGuest</th>\n",
       "      <th>PreviousCancellations</th>\n",
       "      <th>PreviousBookingsNotCanceled</th>\n",
       "      <th>ReservedRoomType</th>\n",
       "      <th>AssignedRoomType</th>\n",
       "      <th>BookingChanges</th>\n",
       "      <th>DepositType</th>\n",
       "      <th>Agent</th>\n",
       "      <th>Company</th>\n",
       "      <th>DaysInWaitingList</th>\n",
       "      <th>CustomerType</th>\n",
       "      <th>ADR</th>\n",
       "      <th>RequiredCarParkingSpaces</th>\n",
       "      <th>TotalOfSpecialRequests</th>\n",
       "      <th>ReservationStatus</th>\n",
       "      <th>ReservationStatusDate</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>HB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Offline TA/TO</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Check-Out</td>\n",
       "      <td>2015-07-03</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>88</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-07-01</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>65</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>68.0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-04-30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>92</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-06-23</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>100</td>\n",
       "      <td>2015</td>\n",
       "      <td>July</td>\n",
       "      <td>27</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>BB</td>\n",
       "      <td>PRT</td>\n",
       "      <td>Online TA</td>\n",
       "      <td>TA/TO</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>A</td>\n",
       "      <td>A</td>\n",
       "      <td>0</td>\n",
       "      <td>No Deposit</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Transient</td>\n",
       "      <td>76.5</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>Canceled</td>\n",
       "      <td>2015-04-02</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   IsCanceled  LeadTime  ...  ReservationStatus ReservationStatusDate\n",
       "0           0         6  ...          Check-Out            2015-07-03\n",
       "1           1        88  ...           Canceled            2015-07-01\n",
       "2           1        65  ...           Canceled            2015-04-30\n",
       "3           1        92  ...           Canceled            2015-06-23\n",
       "4           1       100  ...           Canceled            2015-04-02\n",
       "\n",
       "[5 rows x 31 columns]"
      ]
     },
     "execution_count": 271,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#taking out adults = 0 and children =0 as we considered them as mistakes.\n",
    "#reseting index\n",
    "list_drop = df[(df['Children'] ==0)& (df['Adults'] == 0)].index.to_list()\n",
    "df.drop(list_drop,axis=0,inplace=True)\n",
    "df.reset_index(inplace=True)\n",
    "df.drop('index',axis=1,inplace=True)\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 272,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "OwV9yGyDv1bq",
    "outputId": "b8500a32-bad6-4406-8e9a-197027fb37f9"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0"
      ]
     },
     "execution_count": 272,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "list_drop = df[(df['Children'] ==0)& (df['Adults'] == 0)].index.to_list()\n",
    "len(list_drop)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "TJJnXeeR58ds"
   },
   "source": [
    "## Feature Engineering"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 273,
   "metadata": {
    "id": "3J5lBQahj5MF"
   },
   "outputs": [],
   "source": [
    "df[\"NumberOfPreviousBookings\"]=df[\"PreviousCancellations\"]+df[\"PreviousBookingsNotCanceled\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 274,
   "metadata": {
    "id": "GGUGDwruScYb"
   },
   "outputs": [],
   "source": [
    "df['RationPreviousCancelled']=(df[\"PreviousCancellations\"]/(df[\"PreviousBookingsNotCanceled\"]+df[\"PreviousCancellations\"])).replace(np.inf, 0)\n",
    "df['RationPreviousCancelled']= df['RationPreviousCancelled'].replace(np.nan, 0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 275,
   "metadata": {
    "id": "xNrQ4yswj5mm"
   },
   "outputs": [],
   "source": [
    "#create Check In Feature\n",
    "#create month dictionary\n",
    "month = {\t'Janauary':'01','February':'02','March':'03','April':'04','May':'05','June':'06','July':'07','August':'08','September':'09','October':'10','November':'11','December':'12'\t}\n",
    "#change to pandas df\n",
    "month_df = pd.DataFrame.from_dict(month, orient='index', columns=['month_no'])\n",
    "#merge df with months\n",
    "df = df.merge(month_df, left_on=df['ArrivalDateMonth'], right_index=True)\n",
    "#create date variable\n",
    "df['CheckInDate'] = pd.to_datetime(dict(year=df.ArrivalDateYear, month=df.month_no, day=df.ArrivalDateDayOfMonth))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 276,
   "metadata": {
    "id": "GsR_xTUg6K-2"
   },
   "outputs": [],
   "source": [
    "#cosin of Day of Year\n",
    "df['DayOfYear'] = df['CheckInDate'].dt.dayofyear\n",
    "df['DayOfYear']=np.cos(df['DayOfYear'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 277,
   "metadata": {
    "id": "eg_AsAZohMFM"
   },
   "outputs": [],
   "source": [
    "#features deleted from list_of_features & categorical_features:  'ArrivalDateDayOfMonth', 'DepositType'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 278,
   "metadata": {
    "id": "IcS6twhKd0f-"
   },
   "outputs": [],
   "source": [
    "list_of_features=['LeadTime', 'ArrivalDateMonth',\n",
    "       'ArrivalDateWeekNumber','StaysInWeekendNights', 'StaysInWeekNights', 'Adults', 'Children',\n",
    "       'Babies', 'Meal', 'MarketSegment', 'DistributionChannel',\n",
    "       'IsRepeatedGuest', 'PreviousCancellations',\n",
    "       'PreviousBookingsNotCanceled', 'ReservedRoomType',\n",
    "       'BookingChanges', 'Agent', 'Company','AssignedRoomType',\n",
    "       'DaysInWaitingList', 'CustomerType', 'ADR', 'RequiredCarParkingSpaces',\n",
    "       'TotalOfSpecialRequests','NumberOfPreviousBookings','DayOfYear','IsCanceled','RationPreviousCancelled']\n",
    "categorical_features=['ArrivalDateMonth',\"ArrivalDateWeekNumber\",\n",
    "                      'Meal','MarketSegment','DistributionChannel',\"IsRepeatedGuest\",\n",
    "                      'ReservedRoomType',\"Agent\",'AssignedRoomType',\n",
    "                      \"Company\",\"CustomerType\"]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "dbTFRRACVTaF"
   },
   "source": [
    "# One Hot Encoding"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 279,
   "metadata": {
    "id": "IknNjC1mVSSw"
   },
   "outputs": [],
   "source": [
    "for i in categorical_features:\n",
    "    df[i]=df[i].astype(str)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 280,
   "metadata": {
    "id": "dzQYy6baVSV4"
   },
   "outputs": [],
   "source": [
    "df_train = df.copy()\n",
    "# Use OneHotEncoder to encode the categorical features. Get feature names and create a DataFrame \n",
    "# with the one-hot encoded categorical features \n",
    "#df_train.drop(columns=[\"Agent\",\"Company\"],inplace=True)\n",
    "ohc = OneHotEncoder(sparse=False, drop=\"first\")\n",
    "ohc_feat = ohc.fit_transform(df_train[categorical_features])\n",
    "ohc_feat_names = ohc.get_feature_names()\n",
    "df_train = pd.DataFrame(ohc_feat, index=df_train.index, columns=ohc_feat_names)\n",
    "df=df[list_of_features]\n",
    "encoded = pd.concat([df.drop(columns=categorical_features), df_train], axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 281,
   "metadata": {
    "id": "hnWRGkQvVSgp"
   },
   "outputs": [],
   "source": [
    "data = encoded"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 282,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 456
    },
    "id": "8kZkp-Nv5kSY",
    "outputId": "c6cfec80-dbdf-42db-8af1-1873d4b4bb14"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>LeadTime</th>\n",
       "      <th>StaysInWeekendNights</th>\n",
       "      <th>StaysInWeekNights</th>\n",
       "      <th>Adults</th>\n",
       "      <th>Children</th>\n",
       "      <th>Babies</th>\n",
       "      <th>PreviousCancellations</th>\n",
       "      <th>PreviousBookingsNotCanceled</th>\n",
       "      <th>BookingChanges</th>\n",
       "      <th>DaysInWaitingList</th>\n",
       "      <th>ADR</th>\n",
       "      <th>RequiredCarParkingSpaces</th>\n",
       "      <th>TotalOfSpecialRequests</th>\n",
       "      <th>NumberOfPreviousBookings</th>\n",
       "      <th>DayOfYear</th>\n",
       "      <th>IsCanceled</th>\n",
       "      <th>RationPreviousCancelled</th>\n",
       "      <th>x0_August</th>\n",
       "      <th>x0_December</th>\n",
       "      <th>x0_February</th>\n",
       "      <th>x0_July</th>\n",
       "      <th>x0_June</th>\n",
       "      <th>x0_March</th>\n",
       "      <th>x0_May</th>\n",
       "      <th>x0_November</th>\n",
       "      <th>x0_October</th>\n",
       "      <th>x0_September</th>\n",
       "      <th>x1_11</th>\n",
       "      <th>x1_12</th>\n",
       "      <th>x1_13</th>\n",
       "      <th>x1_14</th>\n",
       "      <th>x1_15</th>\n",
       "      <th>x1_16</th>\n",
       "      <th>x1_17</th>\n",
       "      <th>x1_18</th>\n",
       "      <th>x1_19</th>\n",
       "      <th>x1_20</th>\n",
       "      <th>x1_21</th>\n",
       "      <th>x1_22</th>\n",
       "      <th>x1_23</th>\n",
       "      <th>...</th>\n",
       "      <th>x9_452</th>\n",
       "      <th>x9_46</th>\n",
       "      <th>x9_465</th>\n",
       "      <th>x9_466</th>\n",
       "      <th>x9_47</th>\n",
       "      <th>x9_477</th>\n",
       "      <th>x9_478</th>\n",
       "      <th>x9_479</th>\n",
       "      <th>x9_48</th>\n",
       "      <th>x9_481</th>\n",
       "      <th>x9_483</th>\n",
       "      <th>x9_485</th>\n",
       "      <th>x9_486</th>\n",
       "      <th>x9_489</th>\n",
       "      <th>x9_49</th>\n",
       "      <th>x9_491</th>\n",
       "      <th>x9_492</th>\n",
       "      <th>x9_494</th>\n",
       "      <th>x9_497</th>\n",
       "      <th>x9_51</th>\n",
       "      <th>x9_62</th>\n",
       "      <th>x9_65</th>\n",
       "      <th>x9_67</th>\n",
       "      <th>x9_68</th>\n",
       "      <th>x9_71</th>\n",
       "      <th>x9_72</th>\n",
       "      <th>x9_73</th>\n",
       "      <th>x9_76</th>\n",
       "      <th>x9_78</th>\n",
       "      <th>x9_8</th>\n",
       "      <th>x9_81</th>\n",
       "      <th>x9_84</th>\n",
       "      <th>x9_85</th>\n",
       "      <th>x9_9</th>\n",
       "      <th>x9_91</th>\n",
       "      <th>x9_93</th>\n",
       "      <th>x9_96</th>\n",
       "      <th>x10_Group</th>\n",
       "      <th>x10_Transient</th>\n",
       "      <th>x10_Transient-Party</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.977533</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>88</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>76.50</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.977533</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>65</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>68.00</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.977533</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>92</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>76.50</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.977533</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>100</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>76.50</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.705530</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75225</th>\n",
       "      <td>43</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>154.93</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-0.598460</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75231</th>\n",
       "      <td>245</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>91.93</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>-0.598460</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75238</th>\n",
       "      <td>175</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>91.93</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-0.598460</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75309</th>\n",
       "      <td>184</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>108.51</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.350797</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75311</th>\n",
       "      <td>153</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>153.51</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.350797</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>75433 rows × 519 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       LeadTime  StaysInWeekendNights  ...  x10_Transient  x10_Transient-Party\n",
       "0             6                     0  ...            1.0                  0.0\n",
       "1            88                     0  ...            1.0                  0.0\n",
       "2            65                     0  ...            1.0                  0.0\n",
       "3            92                     2  ...            1.0                  0.0\n",
       "4           100                     0  ...            1.0                  0.0\n",
       "...         ...                   ...  ...            ...                  ...\n",
       "75225        43                     2  ...            1.0                  0.0\n",
       "75231       245                     2  ...            1.0                  0.0\n",
       "75238       175                     2  ...            1.0                  0.0\n",
       "75309       184                     2  ...            1.0                  0.0\n",
       "75311       153                     2  ...            1.0                  0.0\n",
       "\n",
       "[75433 rows x 519 columns]"
      ]
     },
     "execution_count": 282,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "LoDG5ryZcKGI"
   },
   "source": [
    "## Splitting the Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 283,
   "metadata": {
    "id": "nD_8Xj1HcOj2"
   },
   "outputs": [],
   "source": [
    "X = data.drop('IsCanceled',axis=1)\n",
    "y= data['IsCanceled']\n",
    "X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=1)\n",
    "X_train, X_val, y_train, y_val = train_test_split(X_train, y_train, test_size=0.2, random_state=1)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "Zgsq8rIo3SyN"
   },
   "source": [
    "# Outliers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 284,
   "metadata": {
    "id": "cwcX8Rcz3Wdh"
   },
   "outputs": [],
   "source": [
    "numerical_features=['LeadTime', 'StaysInWeekendNights', 'StaysInWeekNights','PreviousCancellations','PreviousBookingsNotCanceled', 'BookingChanges','DaysInWaitingList', 'ADR',\n",
    "       'TotalOfSpecialRequests','NumberOfPreviousBookings']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 285,
   "metadata": {
    "id": "YVgnt2sv4OhL"
   },
   "outputs": [],
   "source": [
    "sns.set()\n",
    "fig, axes = plt.subplots(2, ceil(len(numerical_features) / 2), figsize=(27, 10))\n",
    "for ax, feat in zip(axes.flatten(), numerical_features):\n",
    "  sns.boxplot(X_train[feat], ax=ax)\n",
    "title = \"Numeric Variables\"\n",
    "plt.suptitle(title)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 286,
   "metadata": {
    "id": "CWyRqFqn8RZO"
   },
   "outputs": [],
   "source": [
    "#outlier removal\n",
    "df_new = X_train[~(X_train['LeadTime'] >= 550)]  \n",
    "df_new = df_new[~(df_new['StaysInWeekendNights'] >= 10)]  \n",
    "df_new = df_new[~(df_new['ADR'] >= 1000)]  \n",
    "\n",
    "X_train = df_new"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 287,
   "metadata": {
    "id": "KbKjGcVD9FML"
   },
   "outputs": [],
   "source": [
    "#BOXPLOTS after Outlier removal\n",
    "sns.set()\n",
    "fig, axes = plt.subplots(2, ceil(len(numerical_features) / 2), figsize=(27, 10))\n",
    "for ax, feat in zip(axes.flatten(), numerical_features):\n",
    "  sns.boxplot(X_train[feat], ax=ax)\n",
    "title = \"Numeric Variables\"\n",
    "plt.suptitle(title)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 288,
   "metadata": {
    "id": "39L9rIfRAqw4"
   },
   "outputs": [],
   "source": [
    "#y train delete outliers rows\n",
    "merged_Train = X_train.merge(y_train, how='inner', right_index=True, left_index = True)\n",
    "y_train = merged_Train['IsCanceled']"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "hIpp5ujEvOf3"
   },
   "source": [
    "# Feature Selection"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 289,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "K7wspw3xvQ4P",
    "outputId": "1ccb043e-2072-44bb-f981-e1910fe0b624"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DecisionTreeClassifier(ccp_alpha=0.0, class_weight=None, criterion='entropy',\n",
       "                       max_depth=12, max_features=None, max_leaf_nodes=None,\n",
       "                       min_impurity_decrease=0.0, min_impurity_split=None,\n",
       "                       min_samples_leaf=1, min_samples_split=2,\n",
       "                       min_weight_fraction_leaf=0.0, presort='deprecated',\n",
       "                       random_state=15, splitter='best')"
      ]
     },
     "execution_count": 289,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dt = DecisionTreeClassifier(random_state=15,max_depth = 12,criterion='entropy')\n",
    "dt.fit(X_train,y_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 290,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "nvjE7aTgvXIx",
    "outputId": "a83ac8d8-34f0-4204-b00f-9a72c2fc6a6f"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "The feature importance for LeadTime is : 0.16078588840072425\n",
      "The feature importance for StaysInWeekendNights is : 0.0027119092128993104\n",
      "The feature importance for StaysInWeekNights is : 0.008823704734500578\n",
      "The feature importance for Adults is : 0.005243962458728284\n",
      "The feature importance for Children is : 0.0014140111133101852\n",
      "The feature importance for Babies is : 0.0\n",
      "The feature importance for PreviousCancellations is : 0.0\n",
      "The feature importance for PreviousBookingsNotCanceled is : 0.0\n",
      "The feature importance for BookingChanges is : 0.01965366939701888\n",
      "The feature importance for DaysInWaitingList is : 0.010458195917970177\n",
      "The feature importance for ADR is : 0.028698138656002396\n",
      "The feature importance for RequiredCarParkingSpaces is : 0.02246384068509871\n",
      "The feature importance for TotalOfSpecialRequests is : 0.18889765719053714\n",
      "The feature importance for NumberOfPreviousBookings is : 0.00038809089808849496\n",
      "The feature importance for DayOfYear is : 0.013003887386782024\n",
      "The feature importance for RationPreviousCancelled is : 0.14012229691635822\n",
      "The feature importance for x0_August is : 0.0020826127265503986\n",
      "The feature importance for x0_December is : 0.0028971815016859727\n",
      "The feature importance for x0_February is : 0.001392148522106473\n",
      "The feature importance for x0_July is : 0.0008962556812441952\n",
      "The feature importance for x0_June is : 0.0005021143000958068\n",
      "The feature importance for x0_March is : 0.0009872003580510412\n",
      "The feature importance for x0_May is : 0.0015525357287568342\n",
      "The feature importance for x0_November is : 0.0015392269351235744\n",
      "The feature importance for x0_October is : 0.0022920143353787593\n",
      "The feature importance for x0_September is : 0.00015761262022417959\n",
      "The feature importance for x1_11 is : 0.00032664437192704316\n",
      "The feature importance for x1_12 is : 0.0\n",
      "The feature importance for x1_13 is : 0.00019674063911885137\n",
      "The feature importance for x1_14 is : 0.00048148129204442995\n",
      "The feature importance for x1_15 is : 0.00010619408937222726\n",
      "The feature importance for x1_16 is : 0.0\n",
      "The feature importance for x1_17 is : 0.0003720514846511301\n",
      "The feature importance for x1_18 is : 0.00026701049348817993\n",
      "The feature importance for x1_19 is : 0.00015407852599997118\n",
      "The feature importance for x1_20 is : 0.001197341815101471\n",
      "The feature importance for x1_21 is : 0.0005831879997900332\n",
      "The feature importance for x1_22 is : 0.0017074861976364578\n",
      "The feature importance for x1_23 is : 0.0002384034244114697\n",
      "The feature importance for x1_24 is : 0.0\n",
      "The feature importance for x1_25 is : 0.00013395713181265807\n",
      "The feature importance for x1_26 is : 0.0\n",
      "The feature importance for x1_27 is : 0.0008549928311382867\n",
      "The feature importance for x1_28 is : 0.0\n",
      "The feature importance for x1_29 is : 0.0010475899762872082\n",
      "The feature importance for x1_30 is : 0.0007764985322828608\n",
      "The feature importance for x1_31 is : 0.0002869270278033974\n",
      "The feature importance for x1_32 is : 0.0005856330392983659\n",
      "The feature importance for x1_33 is : 0.0015617911355472708\n",
      "The feature importance for x1_34 is : 0.0008161585682128918\n",
      "The feature importance for x1_35 is : 0.0004216546927223598\n",
      "The feature importance for x1_36 is : 0.0\n",
      "The feature importance for x1_37 is : 0.0003008624906870151\n",
      "The feature importance for x1_38 is : 0.0006278981900505735\n",
      "The feature importance for x1_39 is : 0.0013589099709669485\n",
      "The feature importance for x1_40 is : 0.00013830272955223132\n",
      "The feature importance for x1_41 is : 0.0\n",
      "The feature importance for x1_42 is : 0.0\n",
      "The feature importance for x1_43 is : 0.0\n",
      "The feature importance for x1_44 is : 0.0007235831084743942\n",
      "The feature importance for x1_45 is : 0.00016910687850929247\n",
      "The feature importance for x1_46 is : 0.0007378545956252902\n",
      "The feature importance for x1_47 is : 0.00022947062242790537\n",
      "The feature importance for x1_48 is : 0.0\n",
      "The feature importance for x1_49 is : 0.0\n",
      "The feature importance for x1_5 is : 0.0\n",
      "The feature importance for x1_50 is : 0.0\n",
      "The feature importance for x1_51 is : 0.00017161003463375118\n",
      "The feature importance for x1_52 is : 0.0\n",
      "The feature importance for x1_53 is : 0.00031963535356584845\n",
      "The feature importance for x1_6 is : 0.00019309280153288595\n",
      "The feature importance for x1_7 is : 0.00015968159834506304\n",
      "The feature importance for x1_8 is : 0.0007242650044987632\n",
      "The feature importance for x1_9 is : 0.0\n",
      "The feature importance for x2_FB        is : 0.0015081158871261134\n",
      "The feature importance for x2_HB        is : 0.0019225890187333052\n",
      "The feature importance for x2_SC        is : 0.0019033268916032818\n",
      "The feature importance for x3_Complementary is : 0.0\n",
      "The feature importance for x3_Corporate is : 0.0005167801205353183\n",
      "The feature importance for x3_Direct is : 0.0\n",
      "The feature importance for x3_Groups is : 0.07248743698082903\n",
      "The feature importance for x3_Offline TA/TO is : 0.002925322321862397\n",
      "The feature importance for x3_Online TA is : 0.001584087094489014\n",
      "The feature importance for x3_Undefined is : 0.0\n",
      "The feature importance for x4_Direct is : 0.0014612005476094148\n",
      "The feature importance for x4_GDS is : 0.0\n",
      "The feature importance for x4_TA/TO is : 0.024257246914202887\n",
      "The feature importance for x4_Undefined is : 0.0\n",
      "The feature importance for x5_1 is : 9.072405533106008e-05\n",
      "The feature importance for x6_B                is : 0.0009356113128784113\n",
      "The feature importance for x6_C                is : 0.0\n",
      "The feature importance for x6_D                is : 0.0013561787193385434\n",
      "The feature importance for x6_E                is : 0.00013453480161217102\n",
      "The feature importance for x6_F                is : 0.0008228937114968814\n",
      "The feature importance for x6_G                is : 0.00030400846674867035\n",
      "The feature importance for x7_1 is : 0.00014720488290461802\n",
      "The feature importance for x7_10 is : 0.0\n",
      "The feature importance for x7_103 is : 0.0\n",
      "The feature importance for x7_104 is : 0.0\n",
      "The feature importance for x7_106 is : 0.0\n",
      "The feature importance for x7_107 is : 0.0\n",
      "The feature importance for x7_11 is : 0.0\n",
      "The feature importance for x7_111 is : 0.0\n",
      "The feature importance for x7_112 is : 0.0\n",
      "The feature importance for x7_117 is : 0.0\n",
      "The feature importance for x7_118 is : 0.0\n",
      "The feature importance for x7_119 is : 0.001250130134703034\n",
      "The feature importance for x7_12 is : 0.005802011778204928\n",
      "The feature importance for x7_121 is : 0.0\n",
      "The feature importance for x7_122 is : 0.0\n",
      "The feature importance for x7_128 is : 0.0\n",
      "The feature importance for x7_129 is : 0.0\n",
      "The feature importance for x7_13 is : 0.0\n",
      "The feature importance for x7_132 is : 0.0\n",
      "The feature importance for x7_133 is : 0.0\n",
      "The feature importance for x7_134 is : 0.004224987064903661\n",
      "The feature importance for x7_138 is : 0.0\n",
      "The feature importance for x7_14 is : 0.0005926454021949018\n",
      "The feature importance for x7_141 is : 0.0\n",
      "The feature importance for x7_144 is : 0.0\n",
      "The feature importance for x7_147 is : 0.0\n",
      "The feature importance for x7_148 is : 0.0\n",
      "The feature importance for x7_15 is : 0.0\n",
      "The feature importance for x7_150 is : 0.0\n",
      "The feature importance for x7_151 is : 0.0\n",
      "The feature importance for x7_152 is : 0.0\n",
      "The feature importance for x7_153 is : 0.0\n",
      "The feature importance for x7_154 is : 0.0\n",
      "The feature importance for x7_155 is : 0.0\n",
      "The feature importance for x7_157 is : 0.0\n",
      "The feature importance for x7_158 is : 0.0\n",
      "The feature importance for x7_159 is : 0.0\n",
      "The feature importance for x7_16 is : 0.0\n",
      "The feature importance for x7_162 is : 0.0\n",
      "The feature importance for x7_167 is : 0.0\n",
      "The feature importance for x7_168 is : 0.0\n",
      "The feature importance for x7_17 is : 0.0\n",
      "The feature importance for x7_170 is : 0.0\n",
      "The feature importance for x7_171 is : 0.0\n",
      "The feature importance for x7_173 is : 0.0\n",
      "The feature importance for x7_174 is : 0.0\n",
      "The feature importance for x7_177 is : 0.0\n",
      "The feature importance for x7_179 is : 0.0\n",
      "The feature importance for x7_180 is : 0.0\n",
      "The feature importance for x7_182 is : 0.0\n",
      "The feature importance for x7_187 is : 0.0\n",
      "The feature importance for x7_19 is : 0.0018340672657606713\n",
      "The feature importance for x7_191 is : 0.0016015148242882395\n",
      "The feature importance for x7_192 is : 0.0\n",
      "The feature importance for x7_193 is : 0.0\n",
      "The feature importance for x7_195 is : 0.0\n",
      "The feature importance for x7_196 is : 0.0\n",
      "The feature importance for x7_2 is : 0.0\n",
      "The feature importance for x7_20 is : 0.0\n",
      "The feature importance for x7_205 is : 0.0\n",
      "The feature importance for x7_21 is : 0.0\n",
      "The feature importance for x7_210 is : 0.0\n",
      "The feature importance for x7_211 is : 0.0\n",
      "The feature importance for x7_213 is : 0.0\n",
      "The feature importance for x7_214 is : 0.0002469562701653985\n",
      "The feature importance for x7_215 is : 0.0\n",
      "The feature importance for x7_216 is : 0.0\n",
      "The feature importance for x7_219 is : 0.0\n",
      "The feature importance for x7_22 is : 0.0\n",
      "The feature importance for x7_220 is : 0.0\n",
      "The feature importance for x7_227 is : 0.0\n",
      "The feature importance for x7_229 is : 0.0036994852584821963\n",
      "The feature importance for x7_23 is : 0.0\n",
      "The feature importance for x7_232 is : 0.0\n",
      "The feature importance for x7_234 is : 0.0\n",
      "The feature importance for x7_235 is : 0.0\n",
      "The feature importance for x7_236 is : 0.0\n",
      "The feature importance for x7_24 is : 0.0\n",
      "The feature importance for x7_240 is : 0.0\n",
      "The feature importance for x7_242 is : 0.0\n",
      "The feature importance for x7_247 is : 0.0\n",
      "The feature importance for x7_25 is : 0.0\n",
      "The feature importance for x7_250 is : 0.0\n",
      "The feature importance for x7_252 is : 0.0\n",
      "The feature importance for x7_254 is : 0.0\n",
      "The feature importance for x7_256 is : 0.0\n",
      "The feature importance for x7_26 is : 0.0\n",
      "The feature importance for x7_262 is : 0.0\n",
      "The feature importance for x7_265 is : 0.0\n",
      "The feature importance for x7_267 is : 0.0\n",
      "The feature importance for x7_269 is : 0.0\n",
      "The feature importance for x7_27 is : 0.0011172572049658578\n",
      "The feature importance for x7_270 is : 0.0\n",
      "The feature importance for x7_276 is : 0.00046859462214875793\n",
      "The feature importance for x7_278 is : 0.0\n",
      "The feature importance for x7_28 is : 0.026429665138614635\n",
      "The feature importance for x7_280 is : 0.0\n",
      "The feature importance for x7_281 is : 0.0\n",
      "The feature importance for x7_283 is : 0.0\n",
      "The feature importance for x7_285 is : 0.0\n",
      "The feature importance for x7_286 is : 0.0\n",
      "The feature importance for x7_287 is : 0.0\n",
      "The feature importance for x7_288 is : 0.0\n",
      "The feature importance for x7_289 is : 0.0\n",
      "The feature importance for x7_29 is : 0.0\n",
      "The feature importance for x7_290 is : 0.0\n",
      "The feature importance for x7_294 is : 0.0\n",
      "The feature importance for x7_295 is : 0.0\n",
      "The feature importance for x7_296 is : 0.0\n",
      "The feature importance for x7_3 is : 0.0011650399286578838\n",
      "The feature importance for x7_30 is : 0.0\n",
      "The feature importance for x7_303 is : 0.0\n",
      "The feature importance for x7_306 is : 0.0\n",
      "The feature importance for x7_31 is : 0.0\n",
      "The feature importance for x7_310 is : 0.0\n",
      "The feature importance for x7_315 is : 0.0\n",
      "The feature importance for x7_32 is : 0.0\n",
      "The feature importance for x7_323 is : 0.0\n",
      "The feature importance for x7_325 is : 0.0\n",
      "The feature importance for x7_327 is : 0.0\n",
      "The feature importance for x7_33 is : 0.0\n",
      "The feature importance for x7_330 is : 0.0\n",
      "The feature importance for x7_331 is : 0.0\n",
      "The feature importance for x7_34 is : 0.0\n",
      "The feature importance for x7_341 is : 0.0\n",
      "The feature importance for x7_344 is : 0.0\n",
      "The feature importance for x7_346 is : 0.0\n",
      "The feature importance for x7_35 is : 0.0\n",
      "The feature importance for x7_354 is : 0.0\n",
      "The feature importance for x7_355 is : 0.0\n",
      "The feature importance for x7_359 is : 0.0\n",
      "The feature importance for x7_36 is : 0.0\n",
      "The feature importance for x7_364 is : 0.0\n",
      "The feature importance for x7_37 is : 0.0013628228072809214\n",
      "The feature importance for x7_370 is : 0.0\n",
      "The feature importance for x7_371 is : 0.0\n",
      "The feature importance for x7_375 is : 0.0\n",
      "The feature importance for x7_378 is : 0.0\n",
      "The feature importance for x7_388 is : 0.0\n",
      "The feature importance for x7_39 is : 0.0\n",
      "The feature importance for x7_390 is : 0.0\n",
      "The feature importance for x7_391 is : 0.0\n",
      "The feature importance for x7_394 is : 0.0\n",
      "The feature importance for x7_397 is : 0.0\n",
      "The feature importance for x7_4 is : 0.0\n",
      "The feature importance for x7_40 is : 0.0\n",
      "The feature importance for x7_403 is : 0.0\n",
      "The feature importance for x7_404 is : 0.0\n",
      "The feature importance for x7_408 is : 0.0\n",
      "The feature importance for x7_41 is : 0.0\n",
      "The feature importance for x7_42 is : 0.0\n",
      "The feature importance for x7_423 is : 0.0\n",
      "The feature importance for x7_425 is : 0.0\n",
      "The feature importance for x7_427 is : 0.0\n",
      "The feature importance for x7_436 is : 0.0\n",
      "The feature importance for x7_44 is : 0.0\n",
      "The feature importance for x7_441 is : 0.0\n",
      "The feature importance for x7_444 is : 0.0\n",
      "The feature importance for x7_449 is : 0.0\n",
      "The feature importance for x7_45 is : 0.0\n",
      "The feature importance for x7_453 is : 0.0\n",
      "The feature importance for x7_455 is : 0.0\n",
      "The feature importance for x7_459 is : 0.0\n",
      "The feature importance for x7_461 is : 0.0\n",
      "The feature importance for x7_464 is : 0.0\n",
      "The feature importance for x7_467 is : 0.0\n",
      "The feature importance for x7_47 is : 0.002565001930974957\n",
      "The feature importance for x7_474 is : 0.0\n",
      "The feature importance for x7_475 is : 0.0\n",
      "The feature importance for x7_476 is : 0.0\n",
      "The feature importance for x7_480 is : 0.0\n",
      "The feature importance for x7_484 is : 0.0\n",
      "The feature importance for x7_495 is : 0.0\n",
      "The feature importance for x7_5 is : 0.0\n",
      "The feature importance for x7_50 is : 0.0\n",
      "The feature importance for x7_509 is : 0.0\n",
      "The feature importance for x7_52 is : 0.0\n",
      "The feature importance for x7_53 is : 0.0\n",
      "The feature importance for x7_54 is : 0.0\n",
      "The feature importance for x7_55 is : 0.0\n",
      "The feature importance for x7_56 is : 0.0037807836597292424\n",
      "The feature importance for x7_57 is : 0.0\n",
      "The feature importance for x7_58 is : 0.0\n",
      "The feature importance for x7_6 is : 0.0018404543222014572\n",
      "The feature importance for x7_60 is : 0.0\n",
      "The feature importance for x7_61 is : 0.0\n",
      "The feature importance for x7_63 is : 0.0\n",
      "The feature importance for x7_64 is : 0.0\n",
      "The feature importance for x7_66 is : 0.0\n",
      "The feature importance for x7_69 is : 0.0\n",
      "The feature importance for x7_7 is : 0.0\n",
      "The feature importance for x7_70 is : 0.0\n",
      "The feature importance for x7_71 is : 0.0\n",
      "The feature importance for x7_72 is : 0.0\n",
      "The feature importance for x7_74 is : 0.0\n",
      "The feature importance for x7_75 is : 0.0\n",
      "The feature importance for x7_77 is : 0.0\n",
      "The feature importance for x7_78 is : 0.0\n",
      "The feature importance for x7_79 is : 0.0\n",
      "The feature importance for x7_8 is : 0.0024431798702274346\n",
      "The feature importance for x7_81 is : 0.0\n",
      "The feature importance for x7_82 is : 0.0\n",
      "The feature importance for x7_83 is : 0.0002724314964064293\n",
      "The feature importance for x7_85 is : 0.0005520254966060532\n",
      "The feature importance for x7_86 is : 0.0\n",
      "The feature importance for x7_87 is : 0.0\n",
      "The feature importance for x7_89 is : 0.0\n",
      "The feature importance for x7_9 is : 0.05424116061687192\n",
      "The feature importance for x7_90 is : 0.0\n",
      "The feature importance for x7_91 is : 0.0\n",
      "The feature importance for x7_92 is : 0.0\n",
      "The feature importance for x7_93 is : 0.0\n",
      "The feature importance for x7_94 is : 0.0005210004479906342\n",
      "The feature importance for x7_95 is : 0.0\n",
      "The feature importance for x7_98 is : 0.0\n",
      "The feature importance for x7_99 is : 0.0\n",
      "The feature importance for x8_B                is : 0.002464942781553944\n",
      "The feature importance for x8_C                is : 0.0\n",
      "The feature importance for x8_D                is : 0.011249702040958537\n",
      "The feature importance for x8_E                is : 0.0002108648089099348\n",
      "The feature importance for x8_F                is : 0.00019468532091033308\n",
      "The feature importance for x8_G                is : 0.000440937472685308\n",
      "The feature importance for x8_K                is : 0.0\n",
      "The feature importance for x9_100 is : 0.0\n",
      "The feature importance for x9_101 is : 0.0\n",
      "The feature importance for x9_105 is : 0.0\n",
      "The feature importance for x9_106 is : 0.0\n",
      "The feature importance for x9_107 is : 0.0\n",
      "The feature importance for x9_108 is : 0.0\n",
      "The feature importance for x9_11 is : 0.0\n",
      "The feature importance for x9_110 is : 0.0\n",
      "The feature importance for x9_115 is : 0.0\n",
      "The feature importance for x9_116 is : 0.0\n",
      "The feature importance for x9_120 is : 0.0\n",
      "The feature importance for x9_122 is : 0.0\n",
      "The feature importance for x9_127 is : 0.0\n",
      "The feature importance for x9_130 is : 0.0\n",
      "The feature importance for x9_132 is : 0.0\n",
      "The feature importance for x9_135 is : 0.0\n",
      "The feature importance for x9_137 is : 0.0\n",
      "The feature importance for x9_139 is : 0.0\n",
      "The feature importance for x9_14 is : 0.0\n",
      "The feature importance for x9_140 is : 0.0\n",
      "The feature importance for x9_142 is : 0.0\n",
      "The feature importance for x9_143 is : 0.0\n",
      "The feature importance for x9_144 is : 0.0\n",
      "The feature importance for x9_148 is : 0.0\n",
      "The feature importance for x9_149 is : 0.0\n",
      "The feature importance for x9_150 is : 0.0\n",
      "The feature importance for x9_153 is : 0.0002521278113346589\n",
      "The feature importance for x9_158 is : 0.0\n",
      "The feature importance for x9_160 is : 0.0\n",
      "The feature importance for x9_163 is : 0.0\n",
      "The feature importance for x9_169 is : 0.0\n",
      "The feature importance for x9_174 is : 0.0\n",
      "The feature importance for x9_179 is : 0.0\n",
      "The feature importance for x9_18 is : 0.0\n",
      "The feature importance for x9_180 is : 0.0\n",
      "The feature importance for x9_183 is : 0.0\n",
      "The feature importance for x9_185 is : 0.0\n",
      "The feature importance for x9_186 is : 0.0\n",
      "The feature importance for x9_193 is : 0.0\n",
      "The feature importance for x9_197 is : 0.0012982532863654616\n",
      "The feature importance for x9_202 is : 0.0\n",
      "The feature importance for x9_203 is : 0.0\n",
      "The feature importance for x9_207 is : 0.0\n",
      "The feature importance for x9_209 is : 0.0\n",
      "The feature importance for x9_210 is : 0.0\n",
      "The feature importance for x9_213 is : 0.0\n",
      "The feature importance for x9_215 is : 0.0\n",
      "The feature importance for x9_216 is : 0.0\n",
      "The feature importance for x9_217 is : 0.0\n",
      "The feature importance for x9_218 is : 0.0\n",
      "The feature importance for x9_219 is : 0.0002453388907159192\n",
      "The feature importance for x9_220 is : 0.0\n",
      "The feature importance for x9_221 is : 0.0\n",
      "The feature importance for x9_222 is : 0.0\n",
      "The feature importance for x9_224 is : 0.0\n",
      "The feature importance for x9_227 is : 0.0\n",
      "The feature importance for x9_229 is : 0.0\n",
      "The feature importance for x9_230 is : 0.0\n",
      "The feature importance for x9_233 is : 0.010644448838878384\n",
      "The feature importance for x9_234 is : 0.0\n",
      "The feature importance for x9_237 is : 0.0\n",
      "The feature importance for x9_238 is : 0.0\n",
      "The feature importance for x9_242 is : 0.0\n",
      "The feature importance for x9_243 is : 0.0\n",
      "The feature importance for x9_245 is : 0.0\n",
      "The feature importance for x9_246 is : 0.0\n",
      "The feature importance for x9_251 is : 0.0\n",
      "The feature importance for x9_253 is : 0.0\n",
      "The feature importance for x9_254 is : 0.0\n",
      "The feature importance for x9_255 is : 0.0\n",
      "The feature importance for x9_257 is : 0.0\n",
      "The feature importance for x9_258 is : 0.0\n",
      "The feature importance for x9_259 is : 0.0\n",
      "The feature importance for x9_260 is : 0.0\n",
      "The feature importance for x9_263 is : 0.0\n",
      "The feature importance for x9_264 is : 0.0\n",
      "The feature importance for x9_271 is : 0.0\n",
      "The feature importance for x9_272 is : 0.0\n",
      "The feature importance for x9_273 is : 0.0\n",
      "The feature importance for x9_275 is : 0.0\n",
      "The feature importance for x9_277 is : 0.0\n",
      "The feature importance for x9_278 is : 0.0\n",
      "The feature importance for x9_280 is : 0.0\n",
      "The feature importance for x9_282 is : 0.0\n",
      "The feature importance for x9_284 is : 0.0\n",
      "The feature importance for x9_290 is : 0.0\n",
      "The feature importance for x9_292 is : 0.0\n",
      "The feature importance for x9_293 is : 0.0\n",
      "The feature importance for x9_301 is : 0.0\n",
      "The feature importance for x9_304 is : 0.0\n",
      "The feature importance for x9_305 is : 0.0\n",
      "The feature importance for x9_307 is : 0.0\n",
      "The feature importance for x9_308 is : 0.0\n",
      "The feature importance for x9_309 is : 0.0\n",
      "The feature importance for x9_311 is : 0.0\n",
      "The feature importance for x9_312 is : 0.0\n",
      "The feature importance for x9_313 is : 0.0\n",
      "The feature importance for x9_316 is : 0.0\n",
      "The feature importance for x9_317 is : 0.0\n",
      "The feature importance for x9_319 is : 0.0\n",
      "The feature importance for x9_320 is : 0.0\n",
      "The feature importance for x9_321 is : 0.0\n",
      "The feature importance for x9_329 is : 0.0\n",
      "The feature importance for x9_330 is : 0.0\n",
      "The feature importance for x9_331 is : 0.0\n",
      "The feature importance for x9_332 is : 0.0\n",
      "The feature importance for x9_333 is : 0.0\n",
      "The feature importance for x9_334 is : 0.0\n",
      "The feature importance for x9_341 is : 0.0\n",
      "The feature importance for x9_348 is : 0.0\n",
      "The feature importance for x9_349 is : 0.0\n",
      "The feature importance for x9_35 is : 0.0\n",
      "The feature importance for x9_350 is : 0.0\n",
      "The feature importance for x9_351 is : 0.0\n",
      "The feature importance for x9_352 is : 0.0\n",
      "The feature importance for x9_356 is : 0.0\n",
      "The feature importance for x9_357 is : 0.0\n",
      "The feature importance for x9_358 is : 0.0\n",
      "The feature importance for x9_360 is : 0.0\n",
      "The feature importance for x9_361 is : 0.0\n",
      "The feature importance for x9_362 is : 0.0\n",
      "The feature importance for x9_367 is : 0.0\n",
      "The feature importance for x9_368 is : 0.0\n",
      "The feature importance for x9_369 is : 0.0\n",
      "The feature importance for x9_37 is : 0.0\n",
      "The feature importance for x9_372 is : 0.0\n",
      "The feature importance for x9_377 is : 0.0\n",
      "The feature importance for x9_379 is : 0.0\n",
      "The feature importance for x9_38 is : 0.0\n",
      "The feature importance for x9_383 is : 0.0\n",
      "The feature importance for x9_384 is : 0.0\n",
      "The feature importance for x9_385 is : 0.0\n",
      "The feature importance for x9_393 is : 0.0\n",
      "The feature importance for x9_395 is : 0.0\n",
      "The feature importance for x9_396 is : 0.0\n",
      "The feature importance for x9_40 is : 0.0\n",
      "The feature importance for x9_400 is : 0.0\n",
      "The feature importance for x9_407 is : 0.0\n",
      "The feature importance for x9_408 is : 0.0\n",
      "The feature importance for x9_409 is : 0.0\n",
      "The feature importance for x9_411 is : 0.0\n",
      "The feature importance for x9_417 is : 0.0\n",
      "The feature importance for x9_418 is : 0.0\n",
      "The feature importance for x9_421 is : 0.0\n",
      "The feature importance for x9_424 is : 0.0\n",
      "The feature importance for x9_426 is : 0.0\n",
      "The feature importance for x9_428 is : 0.0\n",
      "The feature importance for x9_429 is : 0.0\n",
      "The feature importance for x9_43 is : 0.0\n",
      "The feature importance for x9_433 is : 0.0\n",
      "The feature importance for x9_435 is : 0.0\n",
      "The feature importance for x9_439 is : 0.0\n",
      "The feature importance for x9_443 is : 0.0\n",
      "The feature importance for x9_444 is : 0.0\n",
      "The feature importance for x9_445 is : 0.0\n",
      "The feature importance for x9_446 is : 0.0\n",
      "The feature importance for x9_448 is : 0.0\n",
      "The feature importance for x9_45 is : 0.0\n",
      "The feature importance for x9_450 is : 0.0\n",
      "The feature importance for x9_451 is : 0.0\n",
      "The feature importance for x9_452 is : 0.00032487985128795596\n",
      "The feature importance for x9_46 is : 0.0\n",
      "The feature importance for x9_465 is : 0.0\n",
      "The feature importance for x9_466 is : 0.0\n",
      "The feature importance for x9_47 is : 0.000362964399533813\n",
      "The feature importance for x9_477 is : 0.0\n",
      "The feature importance for x9_478 is : 0.0\n",
      "The feature importance for x9_479 is : 0.0\n",
      "The feature importance for x9_48 is : 0.0005635243761335909\n",
      "The feature importance for x9_481 is : 0.0\n",
      "The feature importance for x9_483 is : 0.0\n",
      "The feature importance for x9_485 is : 0.0\n",
      "The feature importance for x9_486 is : 0.0\n",
      "The feature importance for x9_489 is : 0.0\n",
      "The feature importance for x9_49 is : 0.0\n",
      "The feature importance for x9_491 is : 0.0\n",
      "The feature importance for x9_492 is : 0.0\n",
      "The feature importance for x9_494 is : 0.0\n",
      "The feature importance for x9_497 is : 0.0\n",
      "The feature importance for x9_51 is : 0.0\n",
      "The feature importance for x9_62 is : 0.0\n",
      "The feature importance for x9_65 is : 0.0\n",
      "The feature importance for x9_67 is : 0.0\n",
      "The feature importance for x9_68 is : 0.0\n",
      "The feature importance for x9_71 is : 0.0\n",
      "The feature importance for x9_72 is : 0.0\n",
      "The feature importance for x9_73 is : 0.0\n",
      "The feature importance for x9_76 is : 0.0\n",
      "The feature importance for x9_78 is : 0.0\n",
      "The feature importance for x9_8 is : 0.0\n",
      "The feature importance for x9_81 is : 0.0\n",
      "The feature importance for x9_84 is : 0.0\n",
      "The feature importance for x9_85 is : 0.0\n",
      "The feature importance for x9_9 is : 0.0\n",
      "The feature importance for x9_91 is : 0.0\n",
      "The feature importance for x9_93 is : 0.0\n",
      "The feature importance for x9_96 is : 0.0\n",
      "The feature importance for x10_Group is : 0.0\n",
      "The feature importance for x10_Transient is : 0.1067527284251411\n",
      "The feature importance for x10_Transient-Party is : 0.0016918721021582487\n"
     ]
    }
   ],
   "source": [
    "fi_col = []\n",
    "fi = []\n",
    "for i,column in enumerate(X_train):\n",
    "    print('The feature importance for {} is : {}'.format(column,dt.feature_importances_[i]))\n",
    "    fi_col.append(column)\n",
    "    fi.append(dt.feature_importances_[i])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 291,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 419
    },
    "id": "TtK5ltotvZKF",
    "outputId": "b37f97d7-1c0c-420c-9ac5-ede360290057"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Features</th>\n",
       "      <th>Features Importance</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>TotalOfSpecialRequests</td>\n",
       "      <td>0.188898</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>LeadTime</td>\n",
       "      <td>0.160786</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>RationPreviousCancelled</td>\n",
       "      <td>0.140122</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>x10_Transient</td>\n",
       "      <td>0.106753</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>x3_Groups</td>\n",
       "      <td>0.072487</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>513</th>\n",
       "      <td>x7_354</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>514</th>\n",
       "      <td>x7_35</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>515</th>\n",
       "      <td>x7_346</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>516</th>\n",
       "      <td>x7_344</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>517</th>\n",
       "      <td>x7_464</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>518 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                    Features  Features Importance\n",
       "0     TotalOfSpecialRequests             0.188898\n",
       "1                   LeadTime             0.160786\n",
       "2    RationPreviousCancelled             0.140122\n",
       "3              x10_Transient             0.106753\n",
       "4                  x3_Groups             0.072487\n",
       "..                       ...                  ...\n",
       "513                   x7_354             0.000000\n",
       "514                    x7_35             0.000000\n",
       "515                   x7_346             0.000000\n",
       "516                   x7_344             0.000000\n",
       "517                   x7_464             0.000000\n",
       "\n",
       "[518 rows x 2 columns]"
      ]
     },
     "execution_count": 291,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "fi_df = zip(fi_col,fi)\n",
    "fi_df = pd.DataFrame(fi_df,columns = ['Features','Features Importance'])\n",
    "fi_df = fi_df.sort_values('Features Importance',ascending= False).reset_index().drop('index',axis=1)\n",
    "fi_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 292,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "yAp0LGmPvZ5k",
    "outputId": "b3ba2b44-f22e-45c7-8ff2-1fc741c800d2"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.axes._subplots.AxesSubplot at 0x7fe2463c9e90>"
      ]
     },
     "execution_count": 292,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "fi_df15 = fi_df[0:10]\n",
    "sns.set_style('whitegrid')\n",
    "sns.barplot(fi_df15['Features Importance'], fi_df15['Features'], palette = 'cubehelix', orient = 'h') "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 293,
   "metadata": {
    "id": "qyeIW6JjvZ8j"
   },
   "outputs": [],
   "source": [
    "fi_df = fi_df[fi_df['Features Importance'] > 0]\n",
    "features_selected= fi_df['Features'].tolist()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 294,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "0X7BinPgarus",
    "outputId": "12e69502-8945-43f8-b778-06c7b14ca2d1"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "107"
      ]
     },
     "execution_count": 294,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(features_selected)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 295,
   "metadata": {
    "id": "L30FiKYdvZ_Z"
   },
   "outputs": [],
   "source": [
    "X_train = X_train[features_selected]\n",
    "X_test = X_test[features_selected]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 296,
   "metadata": {
    "id": "j-BfYdcqYl_j"
   },
   "outputs": [],
   "source": [
    "X_val = X_val[features_selected]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "AHZyLNU2xM4g"
   },
   "source": [
    "# Functions/K-FOLD"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 298,
   "metadata": {
    "id": "jSgvUUCGm8HP"
   },
   "outputs": [],
   "source": [
    "X=pd.concat([X_train,X_test]).reset_index(drop=True)\n",
    "y_train=pd.DataFrame(y_train)\n",
    "y_test=pd.DataFrame(y_test)\n",
    "y=pd.concat([y_train,y_test]).reset_index(drop=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 301,
   "metadata": {
    "id": "Svr4Re0l_QuU"
   },
   "outputs": [],
   "source": [
    "def avg_score(model):\n",
    "    # apply kfold\n",
    "    kf = KFold(n_splits=10)\n",
    "    # create lists to store the results from the different models \n",
    "    score_train = []\n",
    "    score_test = []\n",
    "    timer = []\n",
    "    for train_index, test_index in kf.split(X):\n",
    "        # get the indexes of the observations assigned for each partition\n",
    "        X_train, X_test = X.iloc[train_index], X.iloc[test_index]\n",
    "        y_train, y_test = y.iloc[train_index], y.iloc[test_index]\n",
    "        # start counting time\n",
    "        begin = time.perf_counter()\n",
    "        # fit the model to the data\n",
    "        model.fit(X_train, y_train)\n",
    "        # finish counting time\n",
    "        end = time.perf_counter()\n",
    "        # check the mean accuracy for the train\n",
    "        value_train = f1_score(y_train,model.predict(X_train))\n",
    "        # check the mean accuracy for the test\n",
    "        value_test = f1_score(y_test,model.predict(X_test))\n",
    "        # append the accuracies, the time and the number of iterations in the corresponding list\n",
    "        score_train.append(value_train)\n",
    "        score_test.append(value_test)\n",
    "        timer.append(end-begin)\n",
    "    # calculate the average and the std for each measure (accuracy, time and number of iterations)\n",
    "    avg_time = round(np.mean(timer),3)\n",
    "    avg_train = round(np.mean(score_train),3)\n",
    "    avg_test = round(np.mean(score_test),3)\n",
    "    std_time = round(np.std(timer),2)\n",
    "    std_train = round(np.std(score_train),2)\n",
    "    std_test = round(np.std(score_test),2)\n",
    "    \n",
    "    return str(avg_time) + '+/-' + str(std_time), str(avg_train) + '+/-' + str(std_train),\\\n",
    "str(avg_test) + '+/-' + str(std_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 302,
   "metadata": {
    "id": "309adQaSBiZw"
   },
   "outputs": [],
   "source": [
    "def show_results(df, *args):\n",
    "    \"\"\"\n",
    "    Receive an empty dataframe and the different models and call the function avg_score\n",
    "    \"\"\"\n",
    "    count = 0\n",
    "    # for each model passed as argument\n",
    "    for arg in args:\n",
    "        # obtain the results provided by avg_score\n",
    "        time, avg_train, avg_test = avg_score(arg)\n",
    "        # store the results in the right row\n",
    "        df.iloc[count] = time, avg_train, avg_test\n",
    "        count+=1\n",
    "    return df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "fpT_jaRpxWRK"
   },
   "source": [
    "# Random Forest"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 303,
   "metadata": {
    "id": "HDrs60BW4jkl"
   },
   "outputs": [],
   "source": [
    "modelRF = RandomForestClassifier(random_state = 10,criterion='gini').fit(X_train,y_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 304,
   "metadata": {
    "id": "24PkIXUq8qog"
   },
   "outputs": [],
   "source": [
    "predictionsRF1 = modelRF.predict(X_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 305,
   "metadata": {
    "id": "Gqokkjfy8qrq"
   },
   "outputs": [],
   "source": [
    "cm = confusion_matrix(y_test,predictionsRF1)\n",
    "cm_norm = cm/cm.sum(axis=1).reshape(-1,1)\n",
    "plot_confusion_matrix(modelRF,X_test,y_test)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 306,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "Et1__UgFipsv",
    "outputId": "ed7de5a9-a82a-4fb9-fc3f-af40f14ceaa5"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[8107,  666],\n",
       "       [1366, 4948]])"
      ]
     },
     "execution_count": 306,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "confusion_matrix(y_test,predictionsRF1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 307,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "LQE73t0V8qzk",
    "outputId": "1151826a-afd2-4499-a054-674853305531"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.83"
      ]
     },
     "execution_count": 307,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "round(f1_score(y_test,modelRF.predict(X_test)),2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "AhCoTTdBO811",
    "outputId": "eb80a37a-6719-40cc-cf3b-7d8b13f6b928"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.8653145091800888"
      ]
     },
     "execution_count": 220,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "modelRF.score(X_test, y_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "HUmBGhG18q2L",
    "outputId": "8fa36089-55ef-4588-a95b-acc32bb9a660"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "              precision    recall  f1-score   support\n",
      "\n",
      "           0       0.86      0.92      0.89      8773\n",
      "           1       0.88      0.78      0.83      6314\n",
      "\n",
      "    accuracy                           0.87     15087\n",
      "   macro avg       0.87      0.85      0.86     15087\n",
      "weighted avg       0.87      0.87      0.86     15087\n",
      "\n"
     ]
    }
   ],
   "source": [
    "  print(classification_report(y_test, predictionsRF1))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "QttUQNJ4RHO9",
    "outputId": "1a6fe7fd-e80e-40a6-8137-3dff745ba52d"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.axes._subplots.AxesSubplot at 0x7fe247e7b590>"
      ]
     },
     "execution_count": 222,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "fig = plt.figure(figsize = (10,6))\n",
    "importances = modelRF.feature_importances_\n",
    "features = X_train.columns\n",
    "data_tuples = list(zip(importances, features))\n",
    "data = pd.DataFrame(data_tuples, columns = ['importances', 'features'])\n",
    "data = data.sort_values('importances', ascending = False)\n",
    "data = data[0:5]\n",
    "sns.barplot(data['importances'], data['features'], palette = 'cubehelix', orient = 'h')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 80
    },
    "id": "Nn2-p3E0WhvE",
    "outputId": "ec8c0294-e70d-4ea2-bbfe-b158b42a48f9"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Time</th>\n",
       "      <th>Train</th>\n",
       "      <th>Test</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Random Forest</th>\n",
       "      <td>15.974+/-0.1</td>\n",
       "      <td>0.99+/-0.0</td>\n",
       "      <td>0.835+/-0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                       Time       Train         Test\n",
       "Random Forest  15.974+/-0.1  0.99+/-0.0  0.835+/-0.0"
      ]
     },
     "execution_count": 223,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rf = pd.DataFrame(columns = ['Time','Train','Test'],index=['Random Forest'])\n",
    "show_results(rf,modelRF)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "g-8m5qfPfJlH"
   },
   "outputs": [],
   "source": [
    "#validation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 308,
   "metadata": {
    "id": "V-Z5YQ2NfJnv"
   },
   "outputs": [],
   "source": [
    "predictionsRF2 = modelRF.predict(X_val)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 309,
   "metadata": {
    "id": "wsVVk-3-fQr7"
   },
   "outputs": [],
   "source": [
    "cm = confusion_matrix(y_val,predictionsRF2)\n",
    "cm_norm = cm/cm.sum(axis=1).reshape(-1,1)\n",
    "plot_confusion_matrix(modelRF,X_val,y_val)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 310,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "VKe9DxsqfQuL",
    "outputId": "477d1986-fb9e-4bd3-b074-94e0c13e5481"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[6466,  510],\n",
       "       [1073, 4021]])"
      ]
     },
     "execution_count": 310,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "confusion_matrix(y_val,predictionsRF2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 311,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "rRm_q9gzfQw2",
    "outputId": "01dfb766-7040-480f-ba5e-7bfeaebede05"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.84"
      ]
     },
     "execution_count": 311,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "round(f1_score(y_val,modelRF.predict(X_val)),2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 312,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "NVyt8PjHfQzi",
    "outputId": "fa24abdf-5f96-463f-b229-03331fe7af04"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.8688483844241922"
      ]
     },
     "execution_count": 312,
     "metadata": {
      "tags": []
     },
     "output_type": "execute_result"
    }
   ],
   "source": [
    "modelRF.score(X_val, y_val)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "2soxPZmuFa-m"
   },
   "source": [
    "# Monte Carlo Simulation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "id": "TPGKRUNgGe9G"
   },
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'time' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-1-3862a63ebbb2>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[1;32m----> 1\u001b[1;33m \u001b[0mbegin\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mtime\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mperf_counter\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      2\u001b[0m \u001b[0msamples\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;36m100\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      3\u001b[0m \u001b[0mloops\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;36m100000\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      4\u001b[0m \u001b[0mpercentage_cancelation\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      5\u001b[0m \u001b[1;32mfor\u001b[0m \u001b[0mi\u001b[0m \u001b[1;32min\u001b[0m \u001b[0mrange\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mloops\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'time' is not defined"
     ]
    }
   ],
   "source": [
    "begin=time.perf_counter()\n",
    "samples=100\n",
    "loops=100000\n",
    "percentage_cancelation=[]\n",
    "for i in range(loops):\n",
    "  dataset_sample=X_test.sample(n=samples)\n",
    "  percentage=sum([x[1] for x in modelRF.predict_proba(dataset_sample)])/samples\n",
    "  percentage_cancelation.append(percentage)\n",
    "end=time.perf_counter()\n",
    "end-begin"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "r-C-ToHmVp6o"
   },
   "outputs": [],
   "source": [
    "ax=sns.displot(percentage_cancelation[\"prob\"], kde=True,stat=\"probability\")\n",
    "ax.set(xlabel='Percentage of cancellations', ylabel='Probability Density')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "KMyOu67E8HZM"
   },
   "outputs": [],
   "source": [
    "np.quantile(percentage_cancelation[\"prob\"],0.05)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "s1Sh22zNgpVq"
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "colab": {
   "collapsed_sections": [],
   "name": "Business case 2.ipynb",
   "provenance": [],
   "toc_visible": true
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
